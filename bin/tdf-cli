#!/usr/bin/env node

import { existsSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname } from 'path';

// Converter o import.meta.url para __dirname
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Verificar se estamos no modo de desenvolvimento
const devMode = existsSync(new URL('../src', import.meta.url).pathname);

// Verificar se o usuário quer forçar a versão compilada com --compiled-build
const wantsCompiled = process.argv.indexOf('--compiled-build') >= 0;

if (wantsCompiled || !devMode) {
  // Executar a versão compilada (JavaScript)
  import('../build/src/cli.js').then(cli => cli.run(process.argv));
} else {
  // Executar a versão TypeScript (somente para dev)
  import('ts-node').then(tsNode => {
    tsNode.register({ project: new URL('../tsconfig.json', import.meta.url).pathname });
    import('../src/cli.ts').then(cli => cli.run(process.argv));
  });
}
